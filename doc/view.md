
##Шаблоны

###Основы

Термины Шаблон («template»), Вид («view») или Представление («presentation») — являются синонимами и используются взаимозаменяемо.

Шаблоны нужны для разделения внутренней логики приложения и визуальной части, что позволяет сделать код понятнее и проще для его поддержки.

Пользовательские шаблоны должны храниться в директории `/app/views/`, директория может иметь вложенные папки. 

По умолчанию директория имеет 4 папки:

* **block** — шаблоны для блоков;
* **error** — шаблоны для страниц ошибок;
* **mail** — шаблоны писем эл. почты;
* **main** — другие шаблоны.

Доступ к шаблону осуществляется "точечным путем" `dir.subdir.name`, и хранятся в файлах с расширением `.php`.

###Доступ

Предположим, у нас имеется шаблон `users.php`, который расположен в директории `/app/views/main/`.

```php
<div class="title">{% $title %}</div>

{% if (count($users) > 0) %}
<div class="list">
	<ul>
		{% foreach ($users as $value) %}
		<li>{% $value %}</li>
		{% endforeach %}
	</ul>
</div>
{% else %}
<div class="error">No content</div>
{% endif %}
```

Теперь мы можем передать в этот шаблон значения и скомпилировать его.

```php
// Первый способ - передача массива
$outputData = array();
$outputData['title'] = 'Users list';
$outputData['users'] = array('John', 'Bill', 'Willie', 'Jack');

View::make('main.users', $outputData);

// Второй способ - передача посредствам метода with
$users = array('John', 'Bill', 'Willie', 'Jack');

View::make('main.users')
->with('title', 'Users list');
->with('users', $users);

// Так же методом with можно передать многомерный массив
View::make('main.users')
->with('page.title', 'Users list'); // данный в шаблоне будут находится в $page['title']
->with('page.users', $users); // данный в шаблоне будут находится в $page['users']

// Третий способ - передача посредствам магических свойств
View::make('main.users')->title = 'Users list';
View::make('main.users')->users = array('John', 'Bill', 'Willie', 'Jack');

// Или
$view_users = View::make('main.users');

$view_users->title = 'Users list';
$view_users->users = array('John', 'Bill', 'Willie', 'Jack');

// Очистка (удаление всех переданных значений)
View::make('main.users')->clear();
```

Метод `with` может использовать точечный путь `with('user.name', $user_name)`, что в шаблоне приведет к созданию массива `$user['name']`.

Компиляция шаблона производится автоматически при отправке на печать или вручную.

```php
// Автоматическая
echo View::make('main.users');

//---

Route::get('/users/', function()
{		
	return View::make('main.users');
});

// Ручная
$users_html = View::make('main.users')->compile();

echo $users_html;
```

##Команды

Вы можете использовать предоставленный набор команд для работы с шаблонами, но это необаятельно. 
Все шаблоны компилируются в обычный php файл, поэтому в нем можно использовать команды `{% $title %}`, а можно писать сразу `<?php echo $title; ?>`. Но это дело вкуса и привычки, никакого выигрыша производительно вы не почувствуете. Все скомпилированные шаблоны хранятся в кэше и берутся из него в уже подготовленном виде.

####Подключение дочернего шаблона

```php
{% include('main.header') %}
{% include('main.footer', $outputData) %}
{% include('main.footer', $__viewData) %}
```

Первый способ подключит шаблон `main.header` и передаст в него все переменные из текущей области видимости.
Второй способ подключит шаблон и передаст в него только те значения, которые находятся в массиве `$outputData`. 
Например можно подключать шаблон в цикле и передавать только необходимый набор значений.
Третий способ подключит и передас в него значения из массива `$__viewData`
Массив `$__viewData` доступен в каждом шаблоне и содержит в себе все переменные шаблона, которые тот получил из приложения, но не те, которые были объявлены в самом шаблоне конструкцией `eval()`.
Так же шаблон можно подключить воспользовавшись `{% View::make('main.head', $__viewData)->compile() %}`.

####Печать строки

```php
{% $string %}
{% s($string) %}
{% my_function() %}
```

####Условия if

```php
{% if (is_string($string)) %}
	<b>It`s string</b>
{% elseif (is_number($string)) %}
	<b>It`s number</b>
{% else %}
	<b>Unknown</b>
{% endif %}
```

####Цикл foreach

```php
{% foreach ($list as $key => $value) %}
	{% $key %} — {% $value %} 
{% endforeach %}
```

####Цикл for

```php
{% for ($i=0; $i<count($users); $i++) %}
	{% $i %} — {% $users[$i] %} 
{% endfor %}
```

####Цикл while

```php
{% while ($value = array_shift($user)) %}
	{% $value %} 
{% endwhile %}
```

####Выполнение PHP кода

```php
{% eval($title = 'Title test') %}
```

При возникновении проблем в компиляции шаблона, в место него будет возвращено сообщение об ошибке с именем шаблона и номером проблемной строки. Сервер вернет код ответа 503. Если шаблон не был найден, в место него будет возвращена пустая строка.

